apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: pulpaccessrequests.konflux.io
spec:
  group: konflux.io
  scope: Namespaced
  names:
    plural: pulpaccessrequests
    singular: pulpaccessrequest
    kind: PulpAccessRequest
    shortNames:
      - par
  versions:
    - name: v1alpha1
      served: true
      storage: true
      subresources:
        status: {}
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              type: object
              required:
                - credentialsSecretName
              properties:
                credentialsSecretName:
                  type: string
                  description: |
                    Name of the secret containing authentication credentials.
                    Supports two authentication methods:
                    1. Certificate-based (mTLS): Secret should contain 'cert' or 'tls.crt' and 'key' or 'tls.key'
                    2. Basic Auth: Secret should contain 'username' and 'password'
                    If both are provided, certificate-based authentication takes precedence.
                use_quay_backend:
                  type: boolean
                  description: "Whether to configure Quay as the OCI backend storage for the domain (optional, defaults to false)"
            status:
              type: object
              properties:
                conditions:
                  type: array
                  items:
                    type: object
                    properties:
                      type:
                        type: string
                      status:
                        type: string
                      reason:
                        type: string
                      message:
                        type: string
                      lastTransitionTime:
                        type: string
                        format: date-time
                secretName:
                  type: string
                  description: "Name of the generated secret"
                domain:
                  type: string
                  description: "The auto-generated Pulp domain name (konflux-<namespace>)"
                domainCreated:
                  type: boolean
                  description: "Whether the Pulp domain was created"
                imageRepositoryCreated:
                  type: boolean
                  description: "Whether the ImageRepository was created"
                quayBackendConfigured:
                  type: boolean
                  description: "Whether Quay backend storage was configured"

